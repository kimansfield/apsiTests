#!/bin/bash 
#
#source $HOME/bin/testSuite/configfile
source $HOME/workspace/apsiTests/configfile

runServer() {
  ssh $USER${SERVER[0]} workspace/apsiTests/./runServer 
}

runClient() {
  ./runClient
}

runSample() {
    for trial in {1..1};
    do
	
        runServer >/dev/null 2>&1 & 
	echo "Sleep for 10 seconds to allow server to run properly"
	sleep 10
        runClient >/dev/null 2>&1 & 
        sleep .5
        ./runCurl &
        
	echo "Sample result: $!"

        wait $!
	scp $USER${SERVER[0]}:$APSI_TESTDIR$MD5SUM $APSI_TESTDIR$MD5SUM #Download targetMD5Sum in the server...
        md5check=`md5sum /tmp/ramdisk/blah | awk '{print $1}'`
        echo $md5check > $TEST_DIR/sourceMD5Sum
        cmp sourceMD5Sum $APSI_TESTDIR$MD5SUM
        echo "Done with run:" $trial

    done
}

echo "Running sampleTest script...."

runSample
